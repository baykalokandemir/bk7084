# framework/utils/advanced_city_generator.py

## Overview
The top-level procedural generation class. It starts with a single large rectangle (the city bounds) and recursively subdivides it to create a hierarchical layout of districts, blocks, and lots. It populates this layout with roads, sidewalks, parks, streetlights, and buildings.

## Key Logic
### 1. The "Town Square" Start
* **`_create_town_square`**: Instead of a boring grid, the city starts by carving a **Hexagon** out of the absolute center.
    * This creates a central "Park" polygon.
    * The edges of the hexagon become a "Ring Road".
    * The remaining space is split into radial "Sectors" extending outwards.

### 2. Recursive City Splitting (`_split_city_recursive`)
* **Process:** Takes a large polygon (Sector) and slices it in half using `poly.split()`.
* **Road Generation:** Every time a split occurs, a new **Road Segment** is added to the `RoadNetwork` along the cut line.
* **Hierarchy:**
    * **Depth 0:** Wide Highways (20.0 width, 6 lanes).
    * **Depth 1:** Avenues (14.0 width, 4 lanes).
    * **Depth >1:** Streets (8.0 width, 2 lanes).
* **Termination:** Recursion stops when the block area is smaller than `min_block_area` (4000.0).

### 3. Block & Lot Processing
* **Sidewalks:** The raw block polygons are `inset()` by 3.0 meters to create the curb geometry.
* **Lot Subdivision:** The remaining inner block is recursively split again (`_split_block_recursive`) to create individual building lots. Unlike city splitting, these internal splits do **not** generate roads; they just define property lines.

### 4. Infrastructure & Props
* **Street Lights:**
    * Iterates through the `road_edges` generated by the RoadNetwork.
    * Places `StreetLight` meshes every 25.0 meters.
    * **Math:** Calculates a **LookAt Rotation Matrix** so that every light correctly faces perpendicular to the road, regardless of the road's angle.
* **Buildings:**
    * Generates a `Building` on every lot.
    * **Randomization:** Applies random heights (10-40m), colors, and styles (stepped vs. boxy).
    * **Corner Styling:** Randomly applies `chamfer` (flat cut) or `fillet` (rounded) to building corners for variety.

## Dependencies
* **Internal:** `RoadNetwork`, `Building`, `Polygon`, `StreetLight`, `Shape`.
* **Libraries:** `pyglm`, `numpy`, `random`.